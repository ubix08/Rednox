
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="RedNox - Visual Flow Builder for Node-RED compatible workflows">
  <meta name="theme-color" content="#6366f1">
  <title>RedNox - Flow Builder</title>
  
  <!-- External Dependencies -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.css">
  
  <!-- Application Styles -->
  <link rel="stylesheet" href="styles/variables.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/components.css">
  <link rel="stylesheet" href="styles/canvas.css">
  <link rel="stylesheet" href="styles/mobile.css">
</head>
<body>
  <div class="app" id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="back-btn" id="backBtn" aria-label="Back to flows">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <div class="logo">
          <div class="logo-icon">R</div>
          <span class="logo-text">RedNox</span>
        </div>
        <div class="flow-title" id="flowTitle"></div>
      </div>
      <div class="header-right" id="headerActions">
        <button class="btn btn-primary" id="newFlowBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          <span>New Flow</span>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Flows List View -->
      <div class="flows-view active" id="flowsView">
        <div class="flows-header">
          <div class="search-box">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <input type="text" class="search-input" id="flowSearch" placeholder="Search flows...">
          </div>
          <div class="flows-stats" id="flowsStats">
            <span class="stat-item">
              <span class="stat-value">0</span>
              <span class="stat-label">Flows</span>
            </span>
            <span class="stat-item">
              <span class="stat-value">0</span>
              <span class="stat-label">Active</span>
            </span>
          </div>
        </div>
        <div class="flows-container" id="flowsContainer">
          <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading flows...</p>
          </div>
        </div>
      </div>

      <!-- Canvas View -->
      <div class="canvas-view" id="canvasView">
        <div id="drawflow"></div>
        
        <!-- Canvas Toolbar -->
        <div class="canvas-toolbar">
          <button class="toolbar-btn toolbar-btn-primary" id="addNodeBtn" title="Add Node (N)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" id="zoomInBtn" title="Zoom In (+)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35M11 8v6M8 11h6"/>
            </svg>
          </button>
          <button class="toolbar-btn" id="zoomOutBtn" title="Zoom Out (-)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35M8 11h6"/>
            </svg>
          </button>
          <button class="toolbar-btn" id="zoomResetBtn" title="Reset View (0)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/>
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" id="undoBtn" title="Undo (Ctrl+Z)" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v6h6M21 17a9 9 0 00-9-9 9 9 0 00-9 9"/>
            </svg>
          </button>
          <button class="toolbar-btn" id="redoBtn" title="Redo (Ctrl+Y)" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 7v6h-6M3 17a9 9 0 019-9 9 9 0 019 9"/>
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button class="toolbar-btn" id="validateBtn" title="Validate Flow (V)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
          </button>
          <button class="toolbar-btn" id="helpBtn" title="Help (?)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"/>
            </svg>
          </button>
        </div>

        <!-- Zoom Level Indicator -->
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
      </div>
    </main>
  </div>

  <!-- Node Palette -->
  <div class="node-palette" id="nodePalette">
    <div class="palette-handle"></div>
    <div class="palette-header">
      <h3 class="palette-title">Add Node</h3>
      <div class="palette-search">
        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" class="search-input" id="nodeSearch" placeholder="Search nodes...">
      </div>
      <button class="close-btn" id="closePaletteBtn" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="palette-content" id="nodePaletteContent">
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading nodes...</p>
      </div>
    </div>
  </div>

  <!-- Properties Panel -->
  <div class="properties-panel" id="propertiesPanel">
    <div class="properties-header">
      <h3 class="properties-title">Properties</h3>
      <button class="close-btn" id="closePropertiesBtn" aria-label="Close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="properties-content" id="propertiesContent">
      <div class="empty-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>
        </svg>
        <p>Select a node to edit properties</p>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal" id="newFlowModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Flow</h3>
        <button class="close-btn" id="closeNewFlowModal" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <form id="newFlowForm" class="modal-form">
        <div class="form-group">
          <label class="form-label" for="newFlowId">Flow ID *</label>
          <input type="text" class="form-input" id="newFlowId" placeholder="my-flow" pattern="[a-z0-9-]+" required>
          <div class="field-description">Lowercase letters, numbers, and hyphens only</div>
        </div>
        <div class="form-group">
          <label class="form-label" for="newFlowName">Flow Name *</label>
          <input type="text" class="form-input" id="newFlowName" placeholder="My Flow" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="newFlowDesc">Description</label>
          <textarea class="form-textarea" id="newFlowDesc" placeholder="What does this flow do?" rows="3"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancelNewFlowBtn">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Flow</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="helpModal">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 class="modal-title">Keyboard Shortcuts</h3>
        <button class="close-btn" id="closeHelpModal" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="shortcuts-grid">
        <div class="shortcut-item">
          <kbd>N</kbd>
          <span>Add Node</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>S</kbd>
          <span>Save Flow</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>Z</kbd>
          <span>Undo</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>Y</kbd>
          <span>Redo</span>
        </div>
        <div class="shortcut-item">
          <kbd>Delete</kbd>
          <span>Delete Node</span>
        </div>
        <div class="shortcut-item">
          <kbd>+</kbd>
          <span>Zoom In</span>
        </div>
        <div class="shortcut-item">
          <kbd>-</kbd>
          <span>Zoom Out</span>
        </div>
        <div class="shortcut-item">
          <kbd>0</kbd>
          <span>Reset Zoom</span>
        </div>
        <div class="shortcut-item">
          <kbd>V</kbd>
          <span>Validate Flow</span>
        </div>
        <div class="shortcut-item">
          <kbd>?</kbd>
          <span>Show Help</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Validation Panel -->
  <div class="validation-panel" id="validationPanel">
    <div class="validation-header">
      <h4>Flow Validation</h4>
      <button class="close-btn" id="closeValidationBtn" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="validation-content" id="validationContent"></div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.js"></script>
  
  <!-- Application Scripts -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <script src="js/api.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/nodes.js"></script>
  <script src="js/canvas.js"></script>
  <script src="js/flows.js"></script>
  <script src="js/validation.js"></script>
  <script src="js/shortcuts.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
